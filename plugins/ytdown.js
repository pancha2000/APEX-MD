// plugins/yt.js

const yt = require('yt-search');
const dylux = require('api-dylux');

// command.js ‡∂ú‡∑ú‡∂±‡∑î‡∑Ä‡∑ô‡∂±‡∑ä cmd ‡∑Å‡∑ä‚Äç‡∂ª‡∑í‡∂≠‡∂∫ import ‡∂ö‡∂ª‡∂ú‡∂±‡∑ä‡∂±.
// ‡∂î‡∂∂‡∂ú‡∑ö plugins ‡∑Ü‡∑ù‡∂Ω‡∑ä‡∂©‡∂ª‡∂∫ index.js ‡∑É‡∂∏‡∂ú ‡∂ë‡∂ö‡∂∏ ‡∂∏‡∂ß‡∑ä‡∂ß‡∂∏‡∑ö ‡∂≠‡∑í‡∂∂‡∑ö ‡∂±‡∂∏‡∑ä
// 'command.js' ‡∂ú‡∑ú‡∂±‡∑î‡∑Ä root folder ‡∂ë‡∂ö‡∑ö ‡∂≠‡∑í‡∂∂‡∑ô‡∂± ‡∂±‡∑í‡∑É‡∑è, ‡∂∏‡∑ô‡∑Ñ‡∑í path ‡∂ë‡∂ö '..' ‡∑Ä‡∂±‡∑î ‡∂á‡∂≠.
const { cmd } = require('../command'); 

// ‡∂î‡∂∂‡∂ú‡∑ö ‡∂∂‡∑ú‡∂ß‡∑ä ‡∂ë‡∂ö‡∑ö custom 'cmd' ‡∑Å‡∑ä‚Äç‡∂ª‡∑í‡∂≠‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∂∫‡∑ô‡∂±‡∑ä ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂Ω‡∑í‡∂∫‡∑è‡∂¥‡∂Ø‡∑í‡∂Ç‡∂†‡∑í ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.
// ‡∂∏‡∑ô‡∂∏ ‡∑Å‡∑ä‚Äç‡∂ª‡∑í‡∂≠‡∂∫ index.js ‡∂∏‡∂ú‡∑í‡∂±‡∑ä cmdObj.function(conn, mek, m, {...}) ‡∂Ω‡∑ô‡∑É ‡∂ö‡∑ê‡∂≥‡∑Ä‡∂±‡∑î ‡∂Ω‡∑ê‡∂∂‡∑ö.
cmd({
    pattern: 'yt', // ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∂≠‡∑ä‡∂∏‡∂ö ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∂ª‡∂± ‡∂ª‡∂ß‡∑è‡∑Ä (‡∂ã‡∂Ø‡∑è: /yt)
    desc: 'YouTube ‡∂ú‡∑ì‡∂≠ ‡∑Ñ‡∑ù ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù ‡∂∂‡∑è‡∂ú‡∂≠ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.', // ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫‡∑ö ‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª‡∂∫
    usage: '[audio|video] <search query>', // ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∂∫ ‡∂¥‡∑í‡∑Ö‡∑í‡∂∂‡∂≥ ‡∂ã‡∂¥‡∂Ø‡∑ô‡∑É‡∑ä
    category: 'downloads', // ‡∂î‡∂∂‡∂ú‡∑ö commands ‡∑É‡∂≥‡∑Ñ‡∑è ‡∂á‡∂≠‡∑í category ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂∏‡∑ô‡∑Ñ‡∑í ‡∑É‡∂≥‡∑Ñ‡∂±‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
    filename: __filename, // ‡∂∏‡∑ô‡∂∏ ‡∂¥‡∑ä‡∂Ω‡∂ú‡∑í‡∂±‡∂∫‡∑ö ‡∂ú‡∑ú‡∂±‡∑î ‡∂±‡∑è‡∂∏‡∂∫
    react: 'üé∂' // ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫ ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∂≠‡∑ä‡∂∏‡∂ö ‡∑Ä‡∂± ‡∑Ä‡∑í‡∂ß ‡∂∂‡∑ú‡∂ß‡∑ä ‡∂ë‡∂ö ‡∂∫‡∑Ä‡∂± reaction emoji ‡∂ë‡∂ö
}, async (conn, mek, m, { args, q, reply }) => {
    // conn: Baileys connection object ‡∂ë‡∂ö (‡∂î‡∂∂‡∑ö index.js ‡∂∏‡∂ú‡∑í‡∂±‡∑ä conn.sendFileUrl ‡∂ë‡∂ö‡∂ß ‡∂∏‡∑ô‡∂∫ ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫ ‡∑Ä‡∑ö)
    // mek: Baileys raw message object ‡∂ë‡∂ö
    // m: sms.js ‡∂∏‡∂ú‡∑í‡∂±‡∑ä ‡∑É‡∂ö‡∑É‡∑ä ‡∂ö‡∂ª‡∂± ‡∂Ω‡∂Ø simplified message object ‡∂ë‡∂ö (m.quoted, m.chat ‡∑Ä‡∑ê‡∂±‡∑í ‡∂Ø‡∑ö ‡∂á‡∂≠)
    // args: ‡∑Ä‡∑í‡∂∞‡∑è‡∂±‡∂∫‡∑ô‡∂±‡∑ä ‡∂¥‡∑É‡∑î ‡∂á‡∂≠‡∑í arguments array ‡∂ë‡∂ö (‡∂ã‡∂Ø‡∑è: ['audio', 'Faded', 'Alan', 'Walker'])
    // q: ‡∑É‡∑í‡∂∫‡∂Ω‡∑î arguments string ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂Ω‡∑ô‡∑É (args.join(' ') ‡∑Ñ‡∑è ‡∑É‡∂∏‡∑è‡∂±‡∂∫‡∑í)
    // reply: index.js ‡∂∏‡∂ú‡∑í‡∂±‡∑ä ‡∑É‡∂¥‡∂∫‡∂± ‡∂Ω‡∂Ø message.reply ‡∑Ä‡∑ê‡∂±‡∑í ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∂ö‡∑è‡∂ª‡∑ì‡∂≠‡∑ä‡∑Ä‡∂∫ ‡∑É‡∑Ñ‡∑í‡∂≠ ‡∑Å‡∑ä‚Äç‡∂ª‡∑í‡∂≠‡∂∫

    let type = 'audio'; // ‡∂¥‡∑ô‡∂ª‡∂±‡∑í‡∂∏‡∑í ‡∑Ä‡∂ª‡∑ä‡∂ú‡∂∫ audio ‡∑Ä‡∑ö
    let searchKeywords = args.join(' '); // ‡∑É‡∑í‡∂∫‡∂Ω‡∑î arguments search query ‡∂ë‡∂ö ‡∂Ω‡∑ô‡∑É ‡∂ú‡∂±‡∑ä‡∂±

    // ‡∂¥‡∑Ö‡∂∏‡∑î argument ‡∂ë‡∂ö 'audio' ‡∑Ñ‡∑ù 'video' ‡∂Ø‡∑ê‡∂∫‡∑í ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∑è ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
    if (args.length > 0 && (args[0].toLowerCase() === 'audio' || args[0].toLowerCase() === 'video')) {
        type = args[0].toLowerCase();
        searchKeywords = args.slice(1).join(' '); // ‡∂¥‡∑Ö‡∂∏‡∑î argument ‡∂ë‡∂ö ‡∂â‡∑Ä‡∂≠‡∑ä ‡∂ö‡∂ª ‡∂â‡∂≠‡∑í‡∂ª‡∑í‡∂∫ search query ‡∂ë‡∂ö ‡∂Ω‡∑ô‡∑É ‡∂ú‡∂±‡∑ä‡∂±
    }

    if (!searchKeywords) {
        return reply("‡∂î‡∂∂‡∂ß ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫ ‡∂ú‡∑ì‡∂≠‡∂∫/‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù‡∑Ä ‡∑É‡∑ô‡∑Ä‡∑ì‡∂∏‡∂ß ‡∂±‡∂∏‡∂ö‡∑ä ‡∑É‡∂≥‡∑Ñ‡∂±‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.\n‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∂∫: `/yt [audio|video] <search query>`\n‡∂ã‡∂Ø‡∑è: `/yt Faded Alan Walker` ‡∑Ñ‡∑ù `/yt video How to Train Your Dragon`");
    }

    await reply("‡∑É‡∑ú‡∂∫‡∂∏‡∑í‡∂±‡∑ä ‡∑É‡∑í‡∂ß‡∑ì... ‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂ª‡∑ê‡∂≥‡∑ì ‡∑É‡∑í‡∂ß‡∑í‡∂±‡∑ä‡∂±.");

    try {
        // YouTube ‡∑Ñ‡∑í ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù ‡∑É‡∑ú‡∂∫‡∂±‡∑ä‡∂±
        const videos = await yt.search(searchKeywords);

        if (!videos.videos.length) {
            return reply("‡∂∏‡∂ß ‡∂ö‡∑í‡∑É‡∑í‡∂Ø‡∑î ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂µ‡∂Ω‡∂∫‡∂ö‡∑ä ‡∑É‡∑ú‡∂∫‡∑è‡∂ú‡∂≠ ‡∂±‡∑ú‡∑Ñ‡∑ê‡∂ö‡∑í ‡∑Ä‡∑í‡∂∫. ‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∑Ä‡∑ô‡∂±‡∂≠‡∑ä ‡∂±‡∂∏‡∂ö‡∑ä ‡∂ã‡∂≠‡∑ä‡∑É‡∑è‡∑Ñ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.");
        }

        // ‡∂¥‡∑Ö‡∂∏‡∑î ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂µ‡∂Ω‡∂∫ ‡∂≠‡∑ù‡∂ª‡∑è ‡∂ú‡∂±‡∑ä‡∂±
        const video = videos.videos[0];

        await reply(`'${video.title}' ‡∂∂‡∑è‡∂ú‡∂≠ ‡∂ö‡∂ª‡∂∏‡∑í‡∂±‡∑ä ‡∑É‡∑í‡∂ß‡∑ì (${type})... ‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂ª‡∑ê‡∂≥‡∑ì ‡∑É‡∑í‡∂ß‡∑í‡∂±‡∑ä‡∂±. (‡∂∏‡∑ô‡∂∫‡∂ß ‡∂ß‡∑í‡∂ö ‡∑Ä‡∑ö‡∂Ω‡∑è‡∑Ä‡∂ö‡∑ä ‡∂ú‡∂≠ ‡∑Ä‡∑í‡∂∫ ‡∑Ñ‡∑ê‡∂ö)`);

        let downloadResult;
        if (type === 'audio') {
            downloadResult = await dylux.ytmp3(video.url);
        } else { // type === 'video'
            downloadResult = await dylux.ytmp4(video.url);
        }

        if (!downloadResult || !downloadResult.url) {
            return reply(`'${video.title}' ‡∂∂‡∑è‡∂ú‡∂≠ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö‡∂Ø‡∑ì ‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑ä ‡∑É‡∑í‡∂Ø‡∑î‡∑Ä‡∑í‡∂∫. ‡∂Ö‡∑É‡∂∏‡∑ä‡∂¥‡∑ñ‡∂ª‡∑ä‡∂´ ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂†‡∑è‡∂ª‡∂∫‡∂ö‡∑ä ‡∂Ω‡∑ê‡∂∂‡∑î‡∂´‡∑í.`);
        }

        const captionText = `*${downloadResult.title}*\n\n_‡∂∂‡∑è‡∂ú‡∂≠ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö ‡∑É‡∂∂‡∑ê‡∂≥‡∑í‡∂∫:_ ${downloadResult.url}\n_‡∂ú‡∑ú‡∂±‡∑î ‡∂¥‡∑ä‚Äç‡∂ª‡∂∏‡∑è‡∂´‡∂∫:_ ${downloadResult.filesize || 'N/A'}`;

        // ‡∂î‡∂∂‡∂ú‡∑ö index.js ‡∂∏‡∂ú‡∑í‡∂±‡∑ä conn object ‡∂ë‡∂ö‡∂ß ‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∂ª‡∂± ‡∂Ω‡∂Ø sendFileUrl ‡∑Å‡∑ä‚Äç‡∂ª‡∑í‡∂≠‡∂∫ ‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.
        // ‡∂∏‡∑ô‡∂∫ ‡∂∏‡∂ú‡∑í‡∂±‡∑ä Baileys ‡∑Ñ‡∂ª‡∑Ñ‡∑è ‡∂ú‡∑ú‡∂±‡∑î ‡∂∫‡∑ê‡∑Ä‡∑ì‡∂∏ ‡∑Ä‡∂©‡∑è‡∂≠‡∑ä ‡∂¥‡∑Ñ‡∑É‡∑î ‡∑É‡∑Ñ ‡∂ö‡∑è‡∂ª‡∑ä‡∂∫‡∂ö‡∑ä‡∑Ç‡∂∏ ‡∑Ä‡∑ö.
        // m.chat ‡∂∫‡∂±‡∑î ‡∂∫‡∑Ä‡∂± ‡∂Ω‡∂Ø ‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂©‡∂∫‡∑ö chat ID ‡∂ë‡∂ö‡∂∫‡∑í.
        // m ‡∂∫‡∂±‡∑î quoted message ‡∂ë‡∂ö ‡∑É‡∂≥‡∑Ñ‡∑è ‡∑Ä‡∂± object ‡∂ë‡∂ö‡∂∫‡∑í. (‡∑É‡∂∏‡∑Ñ‡∂ª‡∑Ä‡∑í‡∂ß m.quoted, m.key ‡∑Ä‡∑ê‡∂±‡∑í ‡∂Ø‡∑ö ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫ ‡∑Ä‡∑í‡∂∫ ‡∑Ñ‡∑ê‡∂ö, ‡∂±‡∂∏‡∑î‡∂≠‡∑ä m ‡∂ö‡∑ô‡∂Ω‡∑í‡∂±‡∑ä‡∂∏ ‡∂ú‡∑ú‡∂±‡∑î‡∑Ä‡∂ö‡∑ä ‡∂∫‡∑ê‡∑Ä‡∑ì‡∂∏‡∂ß ‡∂¥‡∑ä‚Äç‡∂ª‡∂∏‡∑è‡∂´‡∑Ä‡∂≠‡∑ä ‡∑Ä‡∑ö.)
        await conn.sendFileUrl(m.chat, downloadResult.url, captionText, m);

    } catch (error) {
        console.error("YouTube ‡∂∂‡∑è‡∂ú‡∂≠ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö ‡∂Ø‡∑ù‡∑Ç‡∂∫:", error);
        // ‡∂Ø‡∑ù‡∑Ç‡∂∫ ‡∂¥‡∑í‡∑Ö‡∑í‡∂∂‡∂≥‡∑Ä ‡∂¥‡∂ª‡∑í‡∑Å‡∑ì‡∂Ω‡∂ö‡∂∫‡∑è‡∂ß ‡∂Ø‡∑ê‡∂±‡∑î‡∂∏‡∑ä ‡∂Ø‡∑ô‡∂±‡∑ä‡∂±.
        // API ‡∑É‡∑ì‡∂∏‡∑è‡∑Ä‡∂±‡∑ä ‡∑Ñ‡∑ù ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù‡∑Ä ‡∂∂‡∑è‡∂ú‡∂≠ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß ‡∂±‡∑ú‡∑Ñ‡∑ê‡∂ö‡∑í ‡∑Ä‡∑ì‡∂∏ ‡∑Ä‡∑ê‡∂±‡∑í ‡∂Ø‡∑ö ‡∑É‡∂≥‡∑Ñ‡∑è ‡∑Ä‡∑ê‡∂©‡∑í‡∂Ø‡∑î‡∂ª ‡∂Ø‡∑ù‡∑Ç ‡∑Ñ‡∑ê‡∑É‡∑í‡∂ª‡∑Ä‡∑ì‡∂∏‡∂ö‡∑ä ‡∂ë‡∂ö‡∂≠‡∑î ‡∂ö‡∑Ö ‡∑Ñ‡∑ê‡∂ö.
        if (error.message.includes("403") || error.message.includes("failed to retrieve")) {
            await reply("‡∂∂‡∑è‡∂ú‡∂≠ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö‡∂Ø‡∑ì ‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑ä ‡∑É‡∑í‡∂Ø‡∑î‡∑Ä‡∑í‡∂∫. ‡∑É‡∂∏‡∑Ñ‡∂ª‡∑Ä‡∑í‡∂ß ‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù‡∑Ä ‡∂∂‡∑è‡∂ú‡∂≠ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ß ‡∂±‡∑ú‡∑Ñ‡∑ê‡∂ö‡∑í ‡∑Ä‡∑í‡∂∫ ‡∑Ñ‡∑ê‡∂ö (‡∂ã‡∂Ø‡∑è: ‡∑Ä‡∂∫‡∑É ‡∑É‡∑ì‡∂∏‡∑è ‡∂ö‡∑Ö).");
        } else {
            await reply("‡∂∂‡∑è‡∂ú‡∂≠ ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö‡∂Ø‡∑ì ‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑ä ‡∑É‡∑í‡∂Ø‡∑î‡∑Ä‡∑í‡∂∫. ‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂±‡∑ê‡∑Ä‡∂≠ ‡∂ã‡∂≠‡∑ä‡∑É‡∑è‡∑Ñ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.");
        }
    }
});